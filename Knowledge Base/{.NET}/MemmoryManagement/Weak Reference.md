### **WeakReference –≤ .NET**

`WeakReference<T>` ‚Äì —Ü–µ –∫–ª–∞—Å —É .NET, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–ª–∞–±–∫–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç, —è–∫–µ –Ω–µ –∑–∞–≤–∞–∂–∞—î **Garbage Collector (GC)** –π–æ–≥–æ –≤–∏–¥–∞–ª—è—Ç–∏, —è–∫—â–æ –Ω–∞ —Ü–µ–π –æ–±'—î–∫—Ç –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î —Å–∏–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å.

#### **–ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ?**

–£ –∑–≤–∏—á–∞–π–Ω–æ–º—É –≤–∏–ø–∞–¥–∫—É, –∫–æ–ª–∏ –º–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–±'—î–∫—Ç —É –∑–º—ñ–Ω–Ω—ñ–π –∞–±–æ –∫–æ–ª–µ–∫—Ü—ñ—ó, –Ω–∞ –Ω—å–æ–≥–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **—Å–∏–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è**, —è–∫–µ –Ω–µ –¥–æ–∑–≤–æ–ª—è—î GC –π–æ–≥–æ –≤–∏–¥–∞–ª–∏—Ç–∏. –¶–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –≤–∏—Ç–æ–∫—ñ–≤ –ø–∞–º‚Äô—è—Ç—ñ, —è–∫—â–æ –æ–±'—î–∫—Ç –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω.

`WeakReference<T>` –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –æ–±'—î–∫—Ç, –∞–ª–µ GC –º–æ–∂–µ –π–æ–≥–æ –≤–∏–¥–∞–ª–∏—Ç–∏, —è–∫—â–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø–∞–º‚Äô—è—Ç—ñ.

---

## **üîç –û—Å–Ω–æ–≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è WeakReference**

```csharp
using System;

class Program
{
    static void Main()
    {
        var strongReference = new object();
        WeakReference<object> weakReference = new WeakReference<object>(strongReference);

        Console.WriteLine(weakReference.TryGetTarget(out var obj)); // True (–æ–±'—î–∫—Ç —ñ—Å–Ω—É—î)

        strongReference = null; // –í—ñ–¥–ø—É—Å–∫–∞—î–º–æ —Å–∏–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
        GC.Collect(); // –í–∏–∫–ª–∏–∫–∞—î–º–æ GC

        Console.WriteLine(weakReference.TryGetTarget(out obj)); // False (–æ–±'—î–∫—Ç –º—ñ–≥ –±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–∏–π)
    }
}
```

### **–û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç–æ–¥–∏**

|–ú–µ—Ç–æ–¥|–û–ø–∏—Å|
|---|---|
|`new WeakReference<T>(T target)`|–°—Ç–≤–æ—Ä—é—î —Å–ª–∞–±–∫–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç.|
|`TryGetTarget(out T target)`|–ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –æ–±'—î–∫—Ç —â–µ —ñ—Å–Ω—É—î.|
|`SetTarget(T target)`|–í—Å—Ç–∞–Ω–æ–≤–ª—é—î –Ω–æ–≤–µ —Å–ª–∞–±–∫–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.|

---

## **üìå –î–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ WeakReference**

### ‚úÖ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**

1. **–ö–µ—à—É–≤–∞–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö –æ–±'—î–∫—Ç—ñ–≤**, —â–æ–± GC –º—ñ–≥ –∑–≤—ñ–ª—å–Ω–∏—Ç–∏ —ó—Ö, —è–∫—â–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø–∞–º‚Äô—è—Ç—ñ.
2. **–ü–æ–¥—ñ—ó (event handlers)**, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏—Ç–æ–∫—ñ–≤ –ø–∞–º‚Äô—è—Ç—ñ.
3. **–¢–∏–º—á–∞—Å–æ–≤—ñ –æ–±‚Äô—î–∫—Ç–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –Ω–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É.**
4. **–û–±‚Äô—î–∫—Ç–∏ —É –¥–æ–≤–≥–æ—Ç—Ä–∏–≤–∞–ª–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Dictionary<K, V>`)**, –¥–µ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å —Å—Ç–∞–≤–∞—Ç–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º–∏.

### ‚ùå **–ö–æ–ª–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**

1. **–Ø–∫—â–æ –æ–±'—î–∫—Ç –∑–∞–≤–∂–¥–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω** ‚Äì GC –º–æ–∂–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –π–æ–≥–æ –≤ –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç.
2. **–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö** ‚Äì –Ω–µ–º–∞—î –≥–∞—Ä–∞–Ω—Ç—ñ—ó, —â–æ –æ–±‚Äô—î–∫—Ç –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–º.

---

## **üîÑ –ü—Ä–∏–∫–ª–∞–¥ –∫–µ—à—É–≤–∞–Ω–Ω—è –∑ WeakReference**

```csharp
using System;
using System.Collections.Generic;

class Cache<T>
{
    private Dictionary<string, WeakReference<T>> _cache = new();

    public void Add(string key, T item)
    {
        _cache[key] = new WeakReference<T>(item);
    }

    public T Get(string key)
    {
        if (_cache.TryGetValue(key, out var weakRef) && weakRef.TryGetTarget(out var target))
        {
            return target;
        }
        return default; // –û–±'—î–∫—Ç –±—É–≤ –≤–∏–¥–∞–ª–µ–Ω–∏–π GC
    }
}

class Program
{
    static void Main()
    {
        Cache<string> cache = new();
        cache.Add("key1", "Hello, WeakReference!");

        GC.Collect(); // –ü—Ä–∏–º—É—Å–æ–≤–∏–π –∑–±—ñ—Ä —Å–º—ñ—Ç—Ç—è

        string value = cache.Get("key1");
        Console.WriteLine(value ?? "Object was collected"); // –ú–æ–∂–µ –±—É—Ç–∏ null
    }
}
```

---

### **üìù –í–∏—Å–Ω–æ–≤–∫–∏**

- **WeakReference** –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç, –Ω–µ –±–ª–æ–∫—É—é—á–∏ –π–æ–≥–æ –∑–±—ñ—Ä GC.
- –ö–æ—Ä–∏—Å–Ω–æ –¥–ª—è **–∫–µ—à—É–≤–∞–Ω–Ω—è**, **–æ–±—Ä–æ–±–∫–∏ –ø–æ–¥—ñ–π** —Ç–∞ **–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –ø–∞–º‚Äô—è—Ç—ñ**.
- –ù–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –æ—Å–∫—ñ–ª—å–∫–∏ GC –º–æ–∂–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –æ–±‚Äô—î–∫—Ç —É –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç.

–Ø–∫—â–æ —É –≤–∞—Å —î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∫–µ–π—Å, –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—î—é! üöÄ