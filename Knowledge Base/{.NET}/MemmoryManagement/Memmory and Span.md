### **Memory —Ç–∞ Span —É .NET**

–£ —Å—É—á–∞—Å–Ω–æ–º—É .NET —ñ—Å–Ω—É—é—Ç—å **`Span<T>`** —Ç–∞ **`Memory<T>`**, —è–∫—ñ –∑–Ω–∞—á–Ω–æ –ø–æ–∫—Ä–∞—â—É—é—Ç—å —Ä–æ–±–æ—Ç—É –∑ –ø–∞–º‚Äô—è—Ç—Ç—é, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–ø–µ—Ä—É–≤–∞—Ç–∏ –±—É—Ñ–µ—Ä–∞–º–∏ –±–µ–∑ –∑–∞–π–≤–∏—Ö –∞–ª–æ–∫–∞—Ü—ñ–π. –¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –∑ –≤–µ–ª–∏–∫–∏–º–∏ –æ–±—Å—è–≥–∞–º–∏ –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—ñ–≤, –º–µ—Ä–µ–∂–µ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—è).

---

## **1. `Span<T>` ‚Äì —à–≤–∏–¥–∫–∞ —Ä–æ–±–æ—Ç–∞ –∑ –ø–∞–º‚Äô—è—Ç—Ç—é –±–µ–∑ –∞–ª–æ–∫–∞—Ü—ñ—ó**

### **–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ `Span<T>`:**

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (value type)** ‚Äì –Ω–µ —Å—Ç–≤–æ—Ä—é—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –æ–±‚Äô—î–∫—Ç—ñ–≤ —É heap, –ø—Ä–∞—Ü—é—î –≤ stack.
- **–î–æ—Å—Ç—É–ø –¥–æ –º–∞—Å–∏–≤—ñ–≤, `stackalloc`, `UnsafeMemory`** ‚Äì –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∞—Ü—é—î –∑ –±—É–¥—å-—è–∫–∏–º–∏ –±–ª–æ–∫–∞–º–∏ –ø–∞–º'—è—Ç—ñ.
- **–û–ø–µ—Ä—É—î –¥–∞–Ω–∏–º–∏ –±–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è** ‚Äì –¥–æ–∑–≤–æ–ª—è—î –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ –¥–∞–Ω–∏–º–∏ –≤ –º–∞—Å–∏–≤—ñ –±–µ–∑ –∑–∞–π–≤–∏—Ö –∞–ª–æ–∫–∞—Ü—ñ–π.

### **–û—Å–Ω–æ–≤–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Span<T>`:**

1. **–û–±—Ä–æ–±–∫–∞ —á–∞—Å—Ç–∏–Ω–∏ –º–∞—Å–∏–≤—É –±–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è:**
    
    ```csharp
    int[] array = { 1, 2, 3, 4, 5 };
    Span<int> span = new Span<int>(array, 1, 3); // –î–æ—Å—Ç—É–ø –¥–æ {2, 3, 4}
    
    span[0] = 10; // array[1] –∑–º—ñ–Ω–∏—Ç—å—Å—è –Ω–∞ 10
    ```
    
2. **–†–æ–±–æ—Ç–∞ –∑ `stackalloc` –¥–ª—è –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ —É —Å—Ç–µ–∫—É:**
    
    ```csharp
    Span<int> stackSpan = stackalloc int[5];
    stackSpan[0] = 42;
    ```
    
3. **–®–≤–∏–¥–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è –Ω–∞–¥ `string` –±–µ–∑ –∞–ª–æ–∫–∞—Ü—ñ—ó:**
    
    ```csharp
    ReadOnlySpan<char> span = "Hello, World!".AsSpan(7, 5);
    Console.WriteLine(span.ToString()); // "World"
    ```
    

### **–û–±–º–µ–∂–µ–Ω–Ω—è `Span<T>`:**

- **–ù–µ –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —É –ø–æ–ª—è—Ö –∫–ª–∞—Å—É** ‚Äì —á–µ—Ä–µ–∑ —Ç–µ, —â–æ `Span<T>` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—Ç–µ–∫–æ–≤—É –ø–∞–º'—è—Ç—å.
- **–ù–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –º–µ—Ç–æ–¥–∏** ‚Äì `Span<T>` –∂–∏–≤–µ —Ç—ñ–ª—å–∫–∏ —É –ø–æ—Ç–æ—á–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ.

---

## **2. `Memory<T>` ‚Äì –≥–Ω—É—á–∫—ñ—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç `Span<T>`**

### **–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ `Memory<T>`:**

- **Reference type** (–Ω–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ `Span<T>`) ‚Äì –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —É –ø–æ–ª—è—Ö –∫–ª–∞—Å—É.
- **–ü—ñ–¥—Ç—Ä–∏–º—É—î heap-–ø–∞–º‚Äô—è—Ç—å** ‚Äì –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π —É `async`/`await`.
- **–ú–µ—Ç–æ–¥ `.Span` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è `Span<T>`**.

### **–ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Memory<T>`:**

4. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ –º–∞—Å–∏–≤–∞–º–∏:**
    
    ```csharp
    Memory<int> memory = new int[] { 1, 2, 3, 4, 5 };
    Memory<int> slice = memory.Slice(1, 3); // {2, 3, 4}
    ```
    
5. **–†–æ–±–æ—Ç–∞ –∑ `async`-–º–µ—Ç–æ–¥–∞–º–∏ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ –¥–ª—è `Span<T>`):**
    
    ```csharp
    async Task ProcessDataAsync(Memory<byte> memory)
    {
        byte[] buffer = memory.ToArray(); // –ö–æ–ø—ñ—é—î–º–æ —É heap (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤ async)
        await File.WriteAllBytesAsync("output.bin", buffer);
    }
    ```
    

### **–ì–æ–ª–æ–≤–Ω–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å `Memory<T>` –≤—ñ–¥ `Span<T>`:**

|–ü–∞—Ä–∞–º–µ—Ç—Ä|`Span<T>`|`Memory<T>`|
|---|---|---|
|**–¢–∏–ø**|`struct`|`class`|
|**Heap —á–∏ stack?**|Stack (–∞–±–æ stackalloc)|Heap (–∞–±–æ –º–∞—Å–∏–≤)|
|**–ú–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —É –ø–æ–ª—è—Ö –∫–ª–∞—Å—É?**|‚ùå –ù—ñ|‚úÖ –¢–∞–∫|
|**–ú–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –≤ async?**|‚ùå –ù—ñ|‚úÖ –¢–∞–∫|
|**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**|–í–∏—Å–æ–∫–æ—à–≤–∏–¥–∫—ñ—Å–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —É —Å—Ç–µ–∫—É|–ì–Ω—É—á–∫–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞–º'—è—Ç—Ç—é|

---

## **3. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏ –∑ –ø–∞–º‚Äô—è—Ç—Ç—é**

–û–¥–∏–Ω —ñ–∑ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Memory<T>` —Ç–∞ `Span<T>` ‚Äì —Ü–µ **–∑–º–µ–Ω—à–µ–Ω–Ω—è –∞–ª–æ–∫–∞—Ü—ñ–π —Ç–∞ –∫–æ–ø—ñ—é–≤–∞–Ω—å**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞–º—ñ—Å—Ç—å —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó **`Substring()`**, —è–∫–∞ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `Span<T>`:

```csharp
ReadOnlySpan<char> original = "Hello, World!".AsSpan();
ReadOnlySpan<char> world = original.Slice(7, 5);
Console.WriteLine(world.ToString()); // "World"
```

–ü—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –≤–µ–ª–∏–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –º–æ–∂–Ω–∞ —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–∞–π–≤–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ, —â–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:

```csharp
Memory<byte> buffer = new byte[1024]; // –í–∏–¥—ñ–ª—è—î–º–æ –æ–¥–∏–Ω —Ä–∞–∑
await stream.ReadAsync(buffer); // –ß–∏—Ç–∞—î–º–æ —É –≤–∂–µ –≤–∏–¥—ñ–ª–µ–Ω–∏–π –±—É—Ñ–µ—Ä
```

---

## **4. –í–∏—Å–Ω–æ–≤–∫–∏**

- `Span<T>` ‚Äì **–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ—Ç—Ä–∏–≤–∞–ª–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π —É —Å—Ç–µ–∫—É**, —à–≤–∏–¥–∫–∏–π, –∞–ª–µ **–Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –≤ async**.
- `Memory<T>` ‚Äì **–ø—Ä–∞—Ü—é—î –∑ heap, –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –ø–æ–ª—è—Ö –∫–ª–∞—Å—É**, –ø—ñ–¥—Ç—Ä–∏–º—É—î **async**, –∞–ª–µ —Ç—Ä–æ—Ö–∏ –º–µ–Ω—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ.
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Span<T>` —Ç–∞ `Memory<T>` –¥–æ–∑–≤–æ–ª—è—î –∑–Ω–∞—á–Ω–æ **–æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –∑ –ø–∞–º‚Äô—è—Ç—Ç—é**, –∑–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–ª–æ–∫–∞—Ü—ñ–π —Ç–∞ GC-–ø–∞—É–∑.

---

–Ø–∫—â–æ —Ç–∏ –≥–æ—Ç—É—î—à—Å—è –¥–æ **Middle/Senior .NET** —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏, —Ç–æ –∑–Ω–∞–Ω–Ω—è `Span<T>` —Ç–∞ `Memory<T>` —î **–∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º** –¥–ª—è –ø–∏—Ç–∞–Ω—å –Ω–∞ —Ç–µ–º—É **–ø–∞–º‚Äô—è—Ç—ñ, performance tuning —Ç–∞ zero-allocation –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è**.

–ß–∏ —î —è–∫—ñ—Å—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–µ–π—Å–∏, —è–∫—ñ —Ç–∏ —Ö–æ—á–µ—à —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ? üöÄ