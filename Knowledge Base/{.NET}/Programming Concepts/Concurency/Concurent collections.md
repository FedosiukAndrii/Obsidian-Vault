### Thread-Safe –ö–æ–ª–µ–∫—Ü—ñ—ó –≤ .NET

–£ –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –∫–æ–ª–∏ –¥–µ–∫—ñ–ª—å–∫–∞ –ø–æ—Ç–æ–∫—ñ–≤ –ø—Ä–∞—Ü—é—é—Ç—å –∑ –æ–¥–Ω–∏–º–∏ —ñ —Ç–∏–º–∏ –∂ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –¥–∞–Ω–∏—Ö, –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —ó—Ö–Ω—é **–ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å (Thread-Safety)**. –£ .NET –¥–ª—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó, —è–∫—ñ –≤—Ö–æ–¥—è—Ç—å –¥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É —ñ–º–µ–Ω `System.Collections.Concurrent`.

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –¥–µ—Ç–∞–ª—å–Ω–æ –∫–æ–∂–Ω—É –∑ –Ω–∏—Ö:

---

## 1. `ConcurrentDictionary<TKey, TValue>`

### –û–ø–∏—Å

`ConcurrentDictionary<TKey, TValue>` ‚Äì —Ü–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π –∞–Ω–∞–ª–æ–≥ `Dictionary<TKey, TValue>`, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏ –±–µ–∑ —è–≤–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å (`lock`).

### –û—Å–Ω–æ–≤–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **fine-grained locking** (—Ç–æ–±—Ç–æ –±–ª–æ–∫—É—î —Ç—ñ–ª—å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏ —Å–ª–æ–≤–Ω–∏–∫–∞, –∞ –Ω–µ –≤–µ—Å—å —Å–ª–æ–≤–Ω–∏–∫ –∑–∞–≥–∞–ª–æ–º).
- –ü—ñ–¥—Ç—Ä–∏–º—É—î **–∞—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó** (`AddOrUpdate`, `TryAdd`, `TryRemove`).
- –ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–µ –ø—Ä–∞—Ü—é—î –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –¥–µ —á–∞—Å—Ç–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è –¥–∞–Ω—ñ.

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```csharp
var dict = new ConcurrentDictionary<string, int>();

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
dict.TryAdd("item1", 1);

// –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è (—è–∫—â–æ –∫–ª—é—á–∞ –Ω–µ —ñ—Å–Ω—É—î)
dict.AddOrUpdate("item1", 1, (key, oldValue) => oldValue + 1);

// –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è
if (dict.TryGetValue("item1", out int value))
{
    Console.WriteLine($"item1: {value}");
}

// –í–∏–¥–∞–ª–µ–Ω–Ω—è
dict.TryRemove("item1", out _);
```

---

## 2. `ConcurrentQueue<T>`

### –û–ø–∏—Å

`ConcurrentQueue<T>` ‚Äì —Ü–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ —á–µ—Ä–≥–∞, —è–∫–∞ –ø—Ä–∞—Ü—é—î –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º **FIFO (First-In, First-Out)**.

### –û—Å–Ω–æ–≤–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **lock-free –∞–ª–≥–æ—Ä–∏—Ç–º**, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î —à–≤–∏–¥–∫—É —Ä–æ–±–æ—Ç—É.
- –ß—É–¥–æ–≤–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è **—á–µ—Ä–≥ –æ–±—Ä–æ–±–∫–∏ –∑–∞–¥–∞—á** —É –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö.
- –í—ñ–¥—Å—É—Ç–Ω—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó –∞–±–æ –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```csharp
var queue = new ConcurrentQueue<int>();

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
queue.Enqueue(1);
queue.Enqueue(2);

// –í–∏–ª—É—á–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç–∞ (–±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è)
if (queue.TryDequeue(out int result))
{
    Console.WriteLine($"Dequeued: {result}");
}

// –ü–µ—Ä–µ–≥–ª—è–¥ –ø–µ—Ä—à–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –±–µ–∑ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
if (queue.TryPeek(out int peekResult))
{
    Console.WriteLine($"First element: {peekResult}");
}
```

---

## 3. `ConcurrentStack<T>`

### –û–ø–∏—Å

`ConcurrentStack<T>` ‚Äì –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π **—Å—Ç–µ–∫**, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º **LIFO (Last-In, First-Out)**.

### –û—Å–Ω–æ–≤–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **lock-free –∞–ª–≥–æ—Ä–∏—Ç–º** –¥–ª—è —à–≤–∏–¥–∫–æ—ó —Ä–æ–±–æ—Ç–∏.
- –•–æ—Ä–æ—à–∏–π –≤–∏–±—ñ—Ä –¥–ª—è **–≥–ª–∏–±–æ–∫–æ—ó —Ä–µ–∫—É—Ä—Å—ñ—ó** —Ç–∞ **–≤—ñ–¥–∫–∞—Ç—É –æ–ø–µ—Ä–∞—Ü—ñ–π**.
- –ù–µ –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø –¥–æ –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```csharp
var stack = new ConcurrentStack<int>();

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
stack.Push(1);
stack.Push(2);

// –í–∏–ª—É—á–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç–∞ (–æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –¥–æ–¥–∞–Ω–æ–≥–æ)
if (stack.TryPop(out int poppedValue))
{
    Console.WriteLine($"Popped: {poppedValue}");
}

// –ü–µ—Ä–µ–≥–ª—è–¥ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –±–µ–∑ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
if (stack.TryPeek(out int peekedValue))
{
    Console.WriteLine($"Top element: {peekedValue}");
}
```

---

## 4. `ConcurrentBag<T>`

### –û–ø–∏—Å

`ConcurrentBag<T>` ‚Äì —Ü–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ **–Ω–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—è**, –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤, –∫–æ–ª–∏ –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ –ø–æ—Ç—ñ–∫ —è–∫ –¥–æ–¥–∞—î, —Ç–∞–∫ —ñ –∑—á–∏—Ç—É—î –¥–∞–Ω—ñ.

### –û—Å–Ω–æ–≤–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **thread-local storage**, —â–æ —Ä–æ–±–∏—Ç—å —ó—ó –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—é, –∫–æ–ª–∏ –∫–æ–∂–µ–Ω –ø–æ—Ç—ñ–∫ –≤–∑–∞—î–º–æ–¥—ñ—î –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∑—ñ —Å–≤–æ—ó–º–∏ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏.
- –ù–µ –≥–∞—Ä–∞–Ω—Ç—É—î –ø–æ—Ä—è–¥–æ–∫ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.
- –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è **–ø—É–ª—ñ–≤ —Ä–µ—Å—É—Ä—Å—ñ–≤** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—É–ª—ñ–≤ –ø—ñ–¥–∫–ª—é—á–µ–Ω—å).

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```csharp
var bag = new ConcurrentBag<int>();

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
bag.Add(1);
bag.Add(2);

// –í–∏–ª—É—á–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç–∞
if (bag.TryTake(out int result))
{
    Console.WriteLine($"Taken: {result}");
}

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç–∞ (–±–µ–∑ –≤–∏–¥–∞–ª–µ–Ω–Ω—è)
if (bag.TryPeek(out int peekResult))
{
    Console.WriteLine($"Peeked: {peekResult}");
}
```

---

## 5. `BlockingCollection<T>`

### –û–ø–∏—Å

`BlockingCollection<T>` ‚Äì —Ü–µ **–æ–±–≥–æ—Ä—Ç–∫–∞** –¥–ª—è `IProducerConsumerCollection<T>`, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î **–∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å –ø–æ—Ç–æ–∫—ñ–≤ –≤–∏—Ä–æ–±–Ω–∏–∫—ñ–≤ —ñ —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤**.

### –û—Å–Ω–æ–≤–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

- –ú–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `ConcurrentQueue<T>`, `ConcurrentStack<T>` –∞–±–æ `ConcurrentBag<T>` —è–∫ –æ—Å–Ω–æ–≤—É.
- –î–æ–∑–≤–æ–ª—è—î –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –∫–æ–ª–µ–∫—Ü—ñ—ó** (—â–æ–± –æ–±–º–µ–∂–∏—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å –¥–æ–¥–∞–≤–∞–Ω–Ω—è).
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è **–ø–∞—Ä–∞–¥–∏–≥–º–∏ Producer-Consumer**.

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```csharp
var blockingCollection = new BlockingCollection<int>(new ConcurrentQueue<int>(), 5);

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–±–ª–æ–∫—É—î, —è–∫—â–æ –∫–æ–ª–µ–∫—Ü—ñ—è –∑–∞–ø–æ–≤–Ω–µ–Ω–∞)
blockingCollection.Add(1);
blockingCollection.Add(2);

// –í–∏–ª—É—á–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–±–ª–æ–∫—É—î, —è–∫—â–æ –∫–æ–ª–µ–∫—Ü—ñ—è –ø–æ—Ä–æ–∂–Ω—è)
int item = blockingCollection.Take();
Console.WriteLine($"Taken: {item}");
```

---

## –í–∏—Å–Ω–æ–≤–æ–∫: —è–∫—É –∫–æ–ª–µ–∫—Ü—ñ—é –æ–±—Ä–∞—Ç–∏?

|–ö–æ–ª–µ–∫—Ü—ñ—è|–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏|
|---|---|
|**ConcurrentDictionary<TKey, TValue>**|–ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–∞—Ä "–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è"|
|**ConcurrentQueue**|–î–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞–¥–∞—á —É —á–µ—Ä–∑—ñ (FIFO)|
|**ConcurrentStack**|–î–ª—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤—ñ–¥–∫–∞—Ç—É (LIFO)|
|**ConcurrentBag**|–ö–æ–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –Ω–µ–≤–∞–∂–ª–∏–≤–∏–π, —ñ –ø–æ—Ç–æ–∫–∏ —á–∞—Å—Ç–æ –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å –∑—ñ —Å–≤–æ—ó–º–∏ –¥–∞–Ω–∏–º–∏|
|**BlockingCollection**|–î–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–∞—Ç–µ—Ä–Ω—É "–≤–∏—Ä–æ–±–Ω–∏–∫-—Å–ø–æ–∂–∏–≤–∞—á"|

---

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ü–æ—Ä–∞–¥–∏:

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `ConcurrentBag<T>` —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ –ø–æ—Ç—ñ–∫ —á–∞—Å—Ç—ñ—à–µ –¥–æ–¥–∞—î —ñ –∑–∞–±–∏—Ä–∞—î —Å–≤–æ—ó –¥–∞–Ω—ñ.
- `BlockingCollection<T>` –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è **—Ä–µ–≥—É–ª—é–≤–∞–Ω–Ω—è –ø–æ—Ç–æ–∫—ñ–≤** (–æ–±–º–µ–∂–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å).
- `ConcurrentQueue<T>` —ñ `ConcurrentStack<T>` –∫—Ä–∞—â—ñ –∑–∞ `BlockingCollection<T>`, —è–∫—â–æ –Ω–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤ –±–ª–æ–∫—É–≤–∞–Ω–Ω—ñ –ø–æ—Ç–æ–∫—ñ–≤.

–Ø–∫—â–æ —É —Ç–µ–±–µ —î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∫–µ–π—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è, –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∏–±—Ä–∞—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞–±–æ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–¥. üòä