### **Unsafe –∫–æ–¥ –≤ C#**

–í C# **unsafe** (–Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π) –∫–æ–¥ –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø–æ–∫–∞–∂—á–∏–∫–∞–º–∏ (pointers) —Ç–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó –Ω–∞ —Ä—ñ–≤–Ω—ñ –Ω–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–∞–º‚Äô—è—Ç—ñ, –ø–æ–¥—ñ–±–Ω–æ –¥–æ C –∞–±–æ C++. –û–¥–Ω–∞–∫ –≤—ñ–Ω –ø–æ—Ç—Ä–µ–±—É—î –æ—Å–æ–±–ª–∏–≤–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ —É –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ —Ü–µ –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–æ –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–±–æ –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –Ω–∞—Ç–∏–≤–Ω–∏–º –∫–æ–¥–æ–º.

## **1. –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ unsafe –∫–æ–¥—É**

- –î–æ—Å—Ç—É–ø –¥–æ –ø–∞–º‚Äô—è—Ç—ñ —á–µ—Ä–µ–∑ –ø–æ–∫–∞–∂—á–∏–∫–∏.
- –†–æ–±–æ—Ç–∞ –∑ –∞–¥—Ä–µ—Å–∞–º–∏ –æ–±'—î–∫—Ç—ñ–≤.
- –ó–±—ñ–ª—å—à–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (—ñ–Ω–æ–¥—ñ).
- –ü–æ—Ç—Ä—ñ–±–Ω–∞ —è–≤–Ω–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –∑ `/unsafe` –∞–±–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `Allow unsafe code` —É Visual Studio.

## **2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è unsafe –∫–æ–¥—É**

### **–û–≥–æ–ª–æ—à–µ–Ω–Ω—è unsafe –±–ª–æ–∫—É**

```csharp
unsafe
{
    int a = 10;
    int* p = &a; // –ø–æ–∫–∞–∂—á–∏–∫ –Ω–∞ –∑–º—ñ–Ω–Ω—É a
    Console.WriteLine($"–ó–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –ø–æ–∫–∞–∂—á–∏–∫: {*p}");
}
```

–î–ª—è —Ä–æ–±–æ—Ç–∏ –∑ unsafe –∫–æ–¥–æ–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–ª—é—á–∏—Ç–∏ `unsafe` –≤ `csproj`:

```xml
<PropertyGroup>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
</PropertyGroup>
```

### **3. –û–ø–µ—Ä–∞—Ü—ñ—ó –∑ –ø–æ–∫–∞–∂—á–∏–∫–∞–º–∏**

#### **3.1. –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –∑–º—ñ–Ω–Ω–æ—ó**

```csharp
unsafe
{
    int x = 42;
    int* px = &x;
    Console.WriteLine($"–ê–¥—Ä–µ—Å–∞: {(ulong)px}, –ó–Ω–∞—á–µ–Ω–Ω—è: {*px}");
}
```

#### **3.2. –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –ø–æ–∫–∞–∂—á–∏–∫—ñ–≤**

```csharp
unsafe
{
    int[] arr = { 10, 20, 30, 40 };
    fixed (int* p = arr)
    {
        Console.WriteLine($"–ü–µ—Ä—à–µ –∑–Ω–∞—á–µ–Ω–Ω—è: {*p}");
        Console.WriteLine($"–î—Ä—É–≥–µ –∑–Ω–∞—á–µ–Ω–Ω—è: {*(p + 1)}"); // –ó–º—ñ—â–µ–Ω–Ω—è –ø–æ –ø–∞–º'—è—Ç—ñ
    }
}
```

‚ö† **`fixed` –∑–∞–ø–æ–±—ñ–≥–∞—î –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—é –æ–±'—î–∫—Ç–∞ –≤ –∫—É–ø—ñ (GC), —â–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–ø–µ–∫–∏ –ø–æ–∫–∞–∂—á–∏–∫—ñ–≤.**

### **4. `stackalloc` ‚Äî –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –Ω–∞ —Å—Ç–µ–∫—É**

–û–ø–µ—Ä–∞—Ü—ñ—è `stackalloc` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ –≤ —Å—Ç–µ–∫—É, —â–æ —à–≤–∏–¥—à–µ –∑–∞ –∫—É–ø—É (`heap`).

```csharp
unsafe
{
    int* arr = stackalloc int[5];
    for (int i = 0; i < 5; i++)
        arr[i] = i * 10;
    
    for (int i = 0; i < 5; i++)
        Console.WriteLine(arr[i]);
}
```

–ü–µ—Ä–µ–≤–∞–≥–∞ `stackalloc`:

- –®–≤–∏–¥–∫–µ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è/–∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ.
- –ú–µ–Ω—à–µ –≤–ø–ª–∏–≤—É –Ω–∞ GC.

### **5. `fixed` ‚Äî –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç–∞ –≤ –ø–∞–º'—è—Ç—ñ**

–ü—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –ø–æ–∫–∞–∂—á–∏–∫–∞–º–∏ —É –∫–µ—Ä–æ–≤–∞–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ —É–Ω–∏–∫–∞—Ç–∏ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `fixed`:

```csharp
unsafe
{
    string s = "Hello";
    fixed (char* p = s)
    {
        Console.WriteLine(*p); // –í–∏–≤–µ–¥–µ 'H'
    }
}
```

‚ö† **–ë–µ–∑ `fixed` –ø–æ–∫–∞–∂—á–∏–∫ –º–æ–∂–µ —Å—Ç–∞—Ç–∏ –Ω–µ–¥—ñ–π—Å–Ω–∏–º, —è–∫—â–æ GC –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç—å —Ä—è–¥–æ–∫.**

### **6. `Unsafe` API (System.Runtime.CompilerServices.Unsafe)**

–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ `System.Runtime.CompilerServices.Unsafe` –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø–∞–º‚Äô—è—Ç—Ç—é –±–µ–∑ `unsafe` –±–ª–æ–∫—É.

#### **6.1. –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–∫–∞–∂—á–∏–∫–∞ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É**

```csharp
using System.Runtime.CompilerServices;

struct Point { public int X, Y; }

unsafe
{
    Point p = new Point { X = 10, Y = 20 };
    Point* ptr = Unsafe.AsPointer(ref p);
    Console.WriteLine(ptr->X); // 10
}
```

#### **6.2. –ß–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å –ø–∞–º'—è—Ç—ñ –±–µ–∑–ø–µ–∫–∏**

```csharp
int value = 42;
ref int refValue = ref Unsafe.AsRef<int>(&value);
refValue = 100;
Console.WriteLine(value); // 100
```

---

## **7. –î–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è unsafe –∫–æ–¥?**

### ‚úÖ **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ**

- –û–±—Ä–æ–±–∫–∞ –≤–µ–ª–∏–∫–∏—Ö –º–∞—Å–∏–≤—ñ–≤ –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç –Ω–∞ `array bounds checking`.
- –ê–ª–≥–æ—Ä–∏—Ç–º–∏, –¥–µ –≤–∞–∂–ª–∏–≤–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–∞–º‚Äô—è—Ç—ñ.

### ‚úÖ **–Ü–Ω—Ç–µ—Ä–∞–∫—Ü—ñ—è –∑ –Ω–∞—Ç–∏–≤–Ω–∏–º –∫–æ–¥–æ–º (P/Invoke)**

```csharp
[DllImport("user32.dll")]
public static extern int MessageBox(IntPtr hWnd, string text, string caption, uint type);
```

### ‚úÖ **–ú–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—è –∑ –±—É—Ñ–µ—Ä–∞–º–∏**

- –†–æ–±–æ—Ç–∞ –∑ `Span<T>`, `Memory<T>`.
- –ë–µ–∑–ø–µ—á–Ω–µ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏–º–∏ —É —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö.

## **8. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ unsafe –∫–æ–¥—É**

–£ –±–∞–≥–∞—Ç—å–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö unsafe –º–æ–∂–Ω–∞ —É–Ω–∏–∫–Ω—É—Ç–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏:

- `Span<T>` / `Memory<T>` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±—É—Ñ–µ—Ä–∞–º–∏.
- `Marshal` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ø–∞–º‚Äô—è—Ç—Ç—é.
- `GCHandle` –¥–ª—è –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤.

```csharp
Span<int> span = stackalloc int[5]; // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ stackalloc
```

## **9. –í–∏—Å–Ω–æ–≤–æ–∫**

Unsafe-–∫–æ–¥ —É C# —î –ø–æ—Ç—É–∂–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º, –∞–ª–µ –π–æ–≥–æ —Å–ª—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ –æ–±–µ—Ä–µ–∂–Ω—ñ—Å—Ç—é. –í—ñ–Ω –¥–∞—î –∑–º–æ–≥—É:

- –û—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–∞–º‚Äô—è—Ç—Ç—é.
- –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è.
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞—Ç–∏–≤–Ω—ñ API.

–ü—Ä–æ—Ç–µ —á–µ—Ä–µ–∑ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ —Ä–∏–∑–∏–∫–∏ (–≤–∏—Ç–æ–∫–∏ –ø–∞–º‚Äô—è—Ç—ñ, –∞–≤–∞—Ä—ñ–π–Ω—ñ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è) –π–æ–≥–æ –≤–∞—Ä—Ç–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –ª–∏—à–µ —Ç–∞–º, –¥–µ —Ü–µ –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–æ. üöÄ

---
### **–í–∏–ø—Ä–∞–≤–¥–∞–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `unsafe` –∫–æ–¥—É –≤ C#**

–•–æ—á–∞ C# –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–π –Ω–∞ –±–µ–∑–ø–µ—á–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—Ç—é, —î –≤–∏–ø–∞–¥–∫–∏, –∫–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `unsafe` –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–µ —á–µ—Ä–µ–∑ –ø–æ—Ç—Ä–µ–±—É –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–±–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π. –î–∞–ª—ñ –Ω–∞–≤–µ–¥–µ–Ω—ñ –æ—Å–Ω–æ–≤–Ω—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ **`unsafe`** –∫–æ–¥ —î –¥–æ—Ü—ñ–ª—å–Ω–∏–º.

---

## **1. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ**

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö**, `unsafe` –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç, –ø–æ–≤‚Äô—è–∑–∞–Ω–∏—Ö —ñ–∑:

- –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –º–µ–∂ –º–∞—Å–∏–≤—ñ–≤ (`array bounds checking`);
- –≤–∏–∫–ª–∏–∫–∞–º–∏ –º–µ—Ç–æ–¥—ñ–≤ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ø–∞–º'—è—Ç—Ç—é;
- –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏, —è–∫—ñ –≤–∏–∫–æ–Ω—É—î CLR –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏.

### üîπ **–ü—Ä–∏–∫–ª–∞–¥: —à–≤–∏–¥–∫–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —É –º–∞—Å–∏–≤—ñ**

```csharp
unsafe
{
    int[] data = new int[1000];
    fixed (int* p = data)
    {
        for (int i = 0; i < 1000; i++)
        {
            *(p + i) = i; // –®–≤–∏–¥—à–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –º–∞—Å–∏–≤—É –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –º–µ–∂
        }
    }
}
```

üöÄ **–ü—Ä–∏—Å–∫–æ—Ä—é—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π –Ω–∞–¥ –º–∞—Å–∏–≤–∞–º–∏, –æ–º–∏–Ω–∞—é—á–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∏—Ö–æ–¥—É –∑–∞ –º–µ–∂—ñ.**

---

## **2. –†–æ–±–æ—Ç–∞ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –º–∞—Å–∏–≤–∞–º–∏ —ñ –±—É—Ñ–µ—Ä–∞–º–∏**

–î–ª—è **–º–∞—Å–∏–≤—ñ–≤ —ñ –±—É—Ñ–µ—Ä—ñ–≤ –≤–µ–ª–∏–∫–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É** `unsafe` –∑–∞–±–µ–∑–ø–µ—á—É—î:

- –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–µ–∂ (`bounds checking`);
- –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—é —Ä–æ–±–æ—Ç—É –∑ –ø–∞–º‚Äô—è—Ç—Ç—é, —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ–±—ñ–π—Ç–∏ –∑–±–∏—Ä–∞—á —Å–º—ñ—Ç—Ç—è (`GC`).

### üîπ **–ü—Ä–∏–∫–ª–∞–¥: —à–≤–∏–¥–∫–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ –∑ `Buffer.MemoryCopy`**

```csharp
unsafe
{
    int[] src = new int[1000];
    int[] dst = new int[1000];

    fixed (int* pSrc = src, pDst = dst)
    {
        Buffer.MemoryCopy(pSrc, pDst, 1000 * sizeof(int), 1000 * sizeof(int));
    }
}
```

üí° **–ü–µ—Ä–µ–≤–∞–≥–∞:** –º–µ–Ω—à–µ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç, –Ω—ñ–∂ —É `Array.Copy()`, –æ—Å–æ–±–ª–∏–≤–æ –Ω–∞ –≤–µ–ª–∏–∫–∏—Ö –º–∞—Å–∏–≤–∞—Ö.

---

## **3. –Ü–Ω—Ç–µ—Ä–∞–∫—Ü—ñ—è –∑ –Ω–∞—Ç–∏–≤–Ω–∏–º –∫–æ–¥–æ–º (`P/Invoke`, `Interop`)**

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ **C/C++ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞–º–∏ –∞–±–æ WinAPI**, `unsafe` —î –º–∞–π–∂–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–º.

### üîπ **–ü—Ä–∏–∫–ª–∞–¥: –≤–∏–∫–ª–∏–∫ WinAPI —á–µ—Ä–µ–∑ P/Invoke**

```csharp
using System;
using System.Runtime.InteropServices;

class Program
{
    [DllImport("kernel32.dll", SetLastError = true)]
    public static extern bool ReadProcessMemory(IntPtr hProcess, IntPtr lpBaseAddress, 
                                                byte[] lpBuffer, int dwSize, out int lpNumberOfBytesRead);

    static void Main()
    {
        byte[] buffer = new byte[256];
        int bytesRead;
        IntPtr processHandle = IntPtr.Zero; // –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–¥—ñ –±—É–¥–µ –¥—ñ–π—Å–Ω–∏–π —Ö–µ–Ω–¥–ª –ø—Ä–æ—Ü–µ—Å—É
        
        bool success = ReadProcessMemory(processHandle, (IntPtr)0x7FF000, buffer, buffer.Length, out bytesRead);
        Console.WriteLine($"Success: {success}, Bytes Read: {bytesRead}");
    }
}
```

üí° **–í–∏–ø—Ä–∞–≤–¥–∞–Ω–Ω—è:** –≤–∑–∞—î–º–æ–¥—ñ—è –∑ WinAPI –∞–±–æ —ñ–Ω—à–∏–º–∏ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞–º–∏ **–±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ C# –±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±–≥–æ—Ä—Ç–æ–∫.**

---

## **4. –†–æ–±–æ—Ç–∞ –∑—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ —Ç–∞ –ø–∞–∫—É–≤–∞–Ω–Ω—è–º –¥–∞–Ω–∏—Ö**

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ **—Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ –Ω–∞—Ç–∏–≤–Ω–æ–º—É –∫–æ–¥—ñ** –∞–±–æ –≤ **—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö**, `unsafe` –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è–º (`alignment`) —Ç–∞ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è–º –ø–æ–ª—ñ–≤ —É –ø–∞–º‚Äô—è—Ç—ñ.

### üîπ **–ü—Ä–∏–∫–ª–∞–¥: –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–∫–∞–∂—á–∏–∫–∞ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É**

```csharp
using System;
using System.Runtime.CompilerServices;

unsafe struct Data
{
    public int Value1;
    public int Value2;
}

class Program
{
    static void Main()
    {
        Data data = new Data { Value1 = 10, Value2 = 20 };

        unsafe
        {
            Data* ptr = &data;
            Console.WriteLine(ptr->Value1); // 10
        }
    }
}
```

üí° **–í–∏–ø—Ä–∞–≤–¥–∞–Ω–Ω—è:** –º—ñ–Ω—ñ–º—ñ–∑–∞—Ü—ñ—è –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç –Ω–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞–º'—è—Ç—Ç—é.

---

## **5. `stackalloc` –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ –≤ —Å—Ç–µ–∫—É**

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ **—Ç–∏–º—á–∞—Å–æ–≤–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –Ω–µ–≤–µ–ª–∏–∫—ñ –æ–±'—î–º–∏ –¥–∞–Ω–∏—Ö** –±–µ–∑ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –∫—É–ø–∏ (`heap`), –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `stackalloc` **—Å—É—Ç—Ç—î–≤–æ –ø—Ä–∏—Å–∫–æ—Ä—é—î** –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

### üîπ **–ü—Ä–∏–∫–ª–∞–¥: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `stackalloc`**

```csharp
unsafe
{
    int* arr = stackalloc int[5];
    for (int i = 0; i < 5; i++)
        arr[i] = i * 10;

    for (int i = 0; i < 5; i++)
        Console.WriteLine(arr[i]);
}
```

üí° **–ü–µ—Ä–µ–≤–∞–≥–∞:** —à–≤–∏–¥—à–µ –∑–∞ `new int[5]`, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–∞–º'—è—Ç—å –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ—Å–ª—è –≤–∏—Ö–æ–¥—É –∑ –º–µ—Ç–æ–¥—É.

---

## **6. –†–æ–±–æ—Ç–∞ –∑ –ø–∞–º‚Äô—è—Ç—Ç—é —Ç–∞ `Unsafe` API**

–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ `System.Runtime.CompilerServices.Unsafe` –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø–∞–º‚Äô—è—Ç—Ç—é **–±–µ–∑ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–æ–≥–æ `unsafe` –∫–æ–¥—É**, –∞–ª–µ –≤ –¥–µ—è–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –ø–æ—î–¥–Ω–∞–Ω–Ω—è `Unsafe` —Ç–∞ `unsafe` –¥–∞—î –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.

### üîπ **–ü—Ä–∏–∫–ª–∞–¥: –ß–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å –ø–∞–º'—è—Ç—ñ –±–µ–∑–ø–µ–∫–∏**

```csharp
using System.Runtime.CompilerServices;

int value = 42;
ref int refValue = ref Unsafe.AsRef<int>(&value);
refValue = 100;

Console.WriteLine(value); // 100
```

üí° **–í–∏–ø—Ä–∞–≤–¥–∞–Ω–Ω—è:** –¥–∞—î –∑–º–æ–≥—É –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç.

---

## **7. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏ –∑ –≤–µ–ª–∏–∫–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏**

–£ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É C# –ø–µ—Ä–µ–¥–∞—á–∞ **—Å—Ç—Ä—É–∫—Ç—É—Ä –≤–µ–ª–∏–∫–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É** –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞ –∑–Ω–∞—á–µ–Ω–Ω—è–º, —â–æ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º. `unsafe` –¥–æ–∑–≤–æ–ª—è—î **–º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ –Ω–∏–º–∏ —á–µ—Ä–µ–∑ –ø–æ–∫–∞–∂—á–∏–∫–∏**.

### üîπ **–ü—Ä–∏–∫–ª–∞–¥: –ü–µ—Ä–µ–¥–∞—á–∞ –≤–µ–ª–∏–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä —á–µ—Ä–µ–∑ `ref`**

```csharp
struct LargeStruct
{
    public fixed int Data[1000];
}

unsafe void ProcessLargeStruct(ref LargeStruct large)
{
    fixed (int* p = large.Data)
    {
        *(p + 500) = 42; // –ó–º—ñ–Ω–∞ –∑–Ω–∞—á–µ–Ω–Ω—è –±–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤—Å—ñ—î—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
    }
}
```

üí° **–í–∏–ø—Ä–∞–≤–¥–∞–Ω–Ω—è:** –µ–∫–æ–Ω–æ–º—ñ—è –ø–∞–º‚Äô—è—Ç—ñ —Ç–∞ —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –∑–∞–π–≤–∏—Ö –∫–æ–ø—ñ—é–≤–∞–Ω—å.

---

## **–ö–æ–ª–∏ –ù–ï –≤–∞—Ä—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `unsafe`?**

‚ùå **–ó–∞–π–≤–µ —É—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è –∫–æ–¥—É** ‚Äì —è–∫—â–æ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `Span<T>`, `Memory<T>` –∞–±–æ `Marshal`, –∫—Ä–∞—â–µ —É–Ω–∏–∫–∞—Ç–∏ `unsafe`.  
‚ùå **–†–∏–∑–∏–∫ –≤–∏—Ö–æ–¥—É –∑–∞ –º–µ–∂—ñ –º–∞—Å–∏–≤—ñ–≤** ‚Äì –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –¥–æ—Å—Ç—É–ø –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ **–ø–∞–¥—ñ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏**.  
‚ùå **–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `fixed`** ‚Äì –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω—ñ –ø–æ–∫–∞–∂—á–∏–∫–∏ –º–æ–∂—É—Ç—å —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ.

---

## **–í–∏—Å–Ω–æ–≤–∫–∏**

üîπ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `unsafe` —É C# –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–µ —É –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏:

- –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —É **–∫—Ä–∏—Ç–∏—á–Ω–∏—Ö** –¥—ñ–ª—è–Ω–∫–∞—Ö;
- –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –ø—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ **–ø–∞–º‚Äô—è—Ç—ñ** (–±—É—Ñ–µ—Ä–∏, –≤–µ–ª–∏–∫—ñ –º–∞—Å–∏–≤–∏);
- –ø–æ—Ç—Ä—ñ–±–Ω–∞ **–≤–∑–∞—î–º–æ–¥—ñ—è –∑ –Ω–∞—Ç–∏–≤–Ω–∏–º –∫–æ–¥–æ–º** (WinAPI, P/Invoke);
- –ø—Ä–∞—Ü—é—î–º–æ –∑—ñ **—Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏**, —è–∫—ñ –º–∞—é—Ç—å –≤–∏–∑–Ω–∞—á–µ–Ω–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤ –ø–∞–º‚Äô—è—Ç—ñ.

–ó–∞–≥–∞–ª–æ–º, `unsafe` –≤–∞—Ä—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–ª–∏—à–µ —Ç–æ–¥—ñ, –∫–æ–ª–∏ —ñ–Ω—à—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –Ω–µ –¥–∞—é—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–æ—ó –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ** –∞–±–æ **–Ω–µ–º–∞—î –±–µ–∑–ø–µ—á–Ω–æ—ó –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏**. üöÄ

---
## **`stackalloc` —Ç–∞ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–µ–∑ `unsafe` –≤ C#**

`stackalloc` ‚Äî —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º —É C#, —â–æ –¥–æ–∑–≤–æ–ª—è—î **–≤–∏–¥—ñ–ª—è—Ç–∏ –ø–∞–º‚Äô—è—Ç—å —É —Å—Ç–µ–∫—É** –∑–∞–º—ñ—Å—Ç—å –∫—É–ø–∏ (`heap`). –¶–µ –∑–Ω–∞—á–Ω–æ –ø—Ä–∏—à–≤–∏–¥—à—É—î –æ–ø–µ—Ä–∞—Ü—ñ—ó, –æ—Å–∫—ñ–ª—å–∫–∏ **–Ω–µ –≤–∏–º–∞–≥–∞—î —Ä–æ–±–æ—Ç–∏ –∑–±–∏—Ä–∞—á–∞ —Å–º—ñ—Ç—Ç—è (GC)**.

–†–∞–Ω—ñ—à–µ `stackalloc` –º—ñ–≥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—å –ª–∏—à–µ –≤ `unsafe` –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ, –∞–ª–µ –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ **C# 7.2**, –π–æ–≥–æ –º–æ–∂–Ω–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –±–µ–∑ `unsafe`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `Span<T>`.

---

## **1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `stackalloc` —É `unsafe` –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ**

```csharp
unsafe
{
    int* arr = stackalloc int[5];
    for (int i = 0; i < 5; i++)
        arr[i] = i * 10;

    for (int i = 0; i < 5; i++)
        Console.WriteLine(arr[i]);
}
```

üîπ **–ü—Ä–æ–±–ª–µ–º–∞:** –ø–æ—Ç—Ä—ñ–±–Ω–µ `unsafe`, —â–æ —É—Å–∫–ª–∞–¥–Ω—é—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞ –≤–∏–º–∞–≥–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤.

---

## **2. `stackalloc` –±–µ–∑ `unsafe` —á–µ—Ä–µ–∑ `Span<T>`**

–ü–æ—á–∏–Ω–∞—é—á–∏ –∑ **C# 7.2**, –º–æ–∂–Ω–∞ **—É–Ω–∏–∫–Ω—É—Ç–∏ `unsafe`** —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ `stackalloc`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `Span<T>`:

```csharp
Span<int> arr = stackalloc int[5];
for (int i = 0; i < 5; i++)
    arr[i] = i * 10;

foreach (var item in arr)
    Console.WriteLine(item);
```

üí° **–ß–æ–º—É —Ü–µ –∫—Ä–∞—â–µ?**

- **–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ `unsafe`**.
- **–ë–µ–∑–ø–µ—á–Ω–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—Ç—é** (`Span<T>` –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∏—Ö–æ–¥–∏—Ç–∏ –∑–∞ –º–µ–∂—ñ –º–∞—Å–∏–≤—É).
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ** –ø—ñ—Å–ª—è –≤–∏—Ö–æ–¥—É –∑ –º–µ—Ç–æ–¥—É.

---

## **3. `stackalloc` –¥–ª—è –æ–±—Ä–æ–±–∫–∏ —Ä—è–¥–∫—ñ–≤**

–ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **—Ç–∏–º—á–∞—Å–æ–≤–∏–π –±—É—Ñ–µ—Ä** –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ç–µ–∫—Å—Ç–æ–º –±–µ–∑ –∑–∞–π–≤–∏—Ö –∞–ª–æ–∫–∞—Ü—ñ–π —É –∫—É–ø—ñ:

```csharp
Span<char> buffer = stackalloc char[100];
ReadOnlySpan<char> source = "Hello, world!".AsSpan();
source.CopyTo(buffer);
Console.WriteLine(buffer.Slice(0, source.Length).ToString());
```

üîπ **–ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏:**

- `stackalloc char[100]` —Å—Ç–≤–æ—Ä—é—î **–±—É—Ñ–µ—Ä —É —Å—Ç–µ–∫—É**.
- `.Slice(0, source.Length).ToString()` –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–µ–∫—Ç–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ –≤ —Ä—è–¥–æ–∫.

---

## **4. `stackalloc` –¥–ª—è —à–≤–∏–¥–∫–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ –º–∞—Å–∏–≤–∞–º–∏**

–ü—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ **–º–∞–ª–∏—Ö –º–∞—Å–∏–≤—ñ–≤ (–¥–æ 1-2–ö–ë)** `stackalloc` —à–≤–∏–¥—à–∏–π –∑–∞ `new`:

```csharp
void ProcessData()
{
    Span<int> data = stackalloc int[1000]; // –í–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –≤ —Å—Ç–µ–∫—É
    for (int i = 0; i < data.Length; i++)
        data[i] = i;

    Console.WriteLine(data[999]); // –í–∏–≤–µ–¥–µ 999
}
```

üí° **–ü–µ—Ä–µ–≤–∞–≥–∞:** `stackalloc` –Ω–µ —Å—Ç–≤–æ—Ä—é—î —Å–º—ñ—Ç—Ç—è (`GC`) —Ç–∞ –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

---

## **5. `stackalloc` —É –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö**

### **üîπ –û–±—Ä–æ–±–∫–∞ –≤–µ–ª–∏–∫–∏—Ö –æ–±—Å—è–≥—ñ–≤ —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö**

–î–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É –¥–∞–Ω–∏—Ö –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç –Ω–∞ –∫—É–ø—É (`heap`):

```csharp
Span<byte> buffer = stackalloc byte[256];
if (TryReadData(buffer))
{
    Console.WriteLine("Data processed successfully!");
}
```

üí° **–ü–µ—Ä–µ–≤–∞–≥–∞:** –º–∏—Ç—Ç—î–≤–µ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ **–±–µ–∑ –∑–∞–π–≤–∏—Ö –∞–ª–æ–∫–∞—Ü—ñ–π**.

---

## **6. `stackalloc` vs. `ArrayPool<T>.Rent()`**

|**–ö—Ä–∏—Ç–µ—Ä—ñ–π**|**`stackalloc`**|**`ArrayPool<T>.Rent()`**|
|---|---|---|
|**–õ–æ–∫–∞—Ü—ñ—è –ø–∞–º‚Äô—è—Ç—ñ**|–°—Ç–µ–∫|–ö—É–ø–∞ (heap)|
|**–®–≤–∏–¥–∫—ñ—Å—Ç—å**|–î—É–∂–µ –≤–∏—Å–æ–∫–∞|–í–∏—Å–æ–∫–∞|
|**–ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è**|–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ|–ü–æ—Ç—Ä—ñ–±–Ω–µ –≤—Ä—É—á–Ω—É|
|**–û–±—Å—è–≥ –¥–∞–Ω–∏—Ö**|–î–æ ~2–ö–ë|–í–µ–ª–∏–∫–∏–π|
|**GC overhead**|–í—ñ–¥—Å—É—Ç–Ω—ñ–π|–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π|

üîπ **–í–∏—Å–Ω–æ–≤–æ–∫:** `stackalloc` —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å **–¥–ª—è –º–∞–ª–∏—Ö —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –º–∞—Å–∏–≤—ñ–≤**. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ 2–ö–ë ‚Äî –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `ArrayPool<T>.Rent()`.

---

## **–í–∏—Å–Ω–æ–≤–∫–∏**

‚úÖ **`stackalloc` –¥–æ–∑–≤–æ–ª—è—î —à–≤–∏–¥–∫–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø–∞–º‚Äô—è—Ç—Ç—é, —É–Ω–∏–∫–∞—é—á–∏ `GC`.**  
‚úÖ **`Span<T>` –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `stackalloc` –±–µ–∑ `unsafe`, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –±–µ–∑–ø–µ—á–Ω–∏–º.**  
‚úÖ **–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π —ñ–∑ –º–∞–ª–∏–º–∏ —Ç–∏–º—á–∞—Å–æ–≤–∏–º–∏ –º–∞—Å–∏–≤–∞–º–∏.**  
‚úÖ **–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ 2–ö–ë ‚Äî –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `ArrayPool<T>.Rent()`.**

üöÄ **–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —à–≤–∏–¥–∫–æ –æ–ø–µ—Ä—É–≤–∞—Ç–∏ –º–∞—Å–∏–≤–∞–º–∏ –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç ‚Äî `stackalloc` —î —á—É–¥–æ–≤–∏–º –≤–∏–±–æ—Ä–æ–º!**