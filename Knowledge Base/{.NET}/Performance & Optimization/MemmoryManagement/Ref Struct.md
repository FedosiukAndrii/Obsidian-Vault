`ref struct` — це спеціальний тип структури в C#, який обмежує її розміщення лише у стековій пам’яті. Це означає, що такі структури не можуть бути створені у керованій купі (heap), не можуть бути полями класів і не можуть реалізовувати інтерфейси.

### Основні особливості `ref struct`

1. **Завжди знаходиться у стеку**
    
    - `ref struct` не може бути частиною керованої купи, тому не може бути полем класу чи розміщеним у `List<T>` або інших колекціях, що використовують купу.
2. **Обмеження на використання**
    
    - `ref struct` не може реалізовувати інтерфейси.
    - `ref struct` не можна використовувати в асинхронних методах (`async`), оскільки вони передбачають проміжне збереження стану в купі.
    - `ref struct` не можна передавати в лямбда-вирази або використовувати у виразах `async` та `iterator`.
3. **Передача за посиланням**
    
    - `ref struct` за замовчуванням передається за посиланням (як `ref` параметр), що дозволяє уникнути зайвих копіювань.
4. **Приклад використання**
    
    ```csharp
    ref struct SpanWrapper
    {
        private Span<int> _span;
    
        public SpanWrapper(Span<int> span)
        {
            _span = span;
        }
    
        public void SetValue(int index, int value)
        {
            _span[index] = value;
        }
    }
    
    class Program
    {
        static void Main()
        {
            Span<int> numbers = stackalloc int[5];
            var wrapper = new SpanWrapper(numbers);
    
            wrapper.SetValue(0, 42);
            Console.WriteLine(numbers[0]); // 42
        }
    }
    ```
    
5. **Основне призначення** `ref struct` зазвичай використовується для роботи з `Span<T>`, `ReadOnlySpan<T>`, `Stackalloc`, що забезпечує ефективну роботу з пам'яттю без зайвих алокацій.
    

### Висновок

`ref struct` потрібен для безпечної та високопродуктивної роботи з пам’яттю у стеку. Він активно використовується в API, що працюють з `Span<T>`, і запобігає витратам на зборку сміття.