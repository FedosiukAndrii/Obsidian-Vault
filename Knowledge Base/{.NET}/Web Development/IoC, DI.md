### **IoC Container —Ç–∞ –ñ–∏—Ç—Ç—î–≤–∏–π –¶–∏–∫–ª –û–±'—î–∫—Ç—ñ–≤ –Ω–∞ –†—ñ–≤–Ω—ñ Advanced**

**Inversion of Control (IoC) Container** ‚Äì —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ –≤ –¥–æ–¥–∞—Ç–∫–∞—Ö, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥–¥—ñ–ª–∏—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤ –≤—ñ–¥ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ Dependency Injection (DI).

#### **1. –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó IoC Container**

1. **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π**  
    –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–µ, —è–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–∞ –Ω–∞–¥–∞–≤–∞—Ç–∏ –æ–±'—î–∫—Ç–∏.
    
2. **–†–µ–∑–æ–ª—é—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π**  
    –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –æ–±'—î–∫—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–ø—Ä–æ–≤–∞–¥–∂—É—î –≤—Å—ñ –π–æ–≥–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ.
    
3. **–ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –æ–±'—î–∫—Ç—ñ–≤**  
    –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–ø—Ä–∞–≤–ª—è—î –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º –æ–±'—î–∫—Ç—ñ–≤, –≤–∏–∑–Ω–∞—á–∞—é—á–∏, –∫–æ–ª–∏ –≤–æ–Ω–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —ñ –∑–Ω–∏—â—É—é—Ç—å—Å—è.
    

---

## **–ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –æ–±'—î–∫—Ç—ñ–≤ —É IoC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ**

–ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –æ–±'—î–∫—Ç—ñ–≤ (Lifecycle) –≤–∏–∑–Ω–∞—á–∞—î, —è–∫ –¥–æ–≤–≥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä –æ–±'—î–∫—Ç–∞ —ñ—Å–Ω—É—î –≤ –ø–∞–º'—è—Ç—ñ.

### **1. Scoped Lifecycle Models**

#### **1.1. Transient**

üîπ **–û–ø–∏—Å**: –ù–æ–≤–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –≤—ñ–Ω –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è.  
üîπ **–ü–µ—Ä–µ–≤–∞–≥–∏**:

- –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å shared state.
- –ú—ñ–Ω—ñ–º—ñ–∑—É—î —Ä–∏–∑–∏–∫ race condition –≤ –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö.
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥–ª—è lightweight –æ–±'—î–∫—Ç—ñ–≤.  
    üîπ **–ù–µ–¥–æ–ª—ñ–∫–∏**:
- –í–∏—Å–æ–∫—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤ –ø—Ä–∏ —á–∞—Å—Ç–∏—Ö –∑–∞–ø–∏—Ç–∞—Ö.  
    üîπ **–ü—Ä–∏–∫–ª–∞–¥**:

```csharp
services.AddTransient<IMyService, MyService>();
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏**:

- –°–µ—Ä–≤—ñ—Å–∏ –±–µ–∑ —Å—Ç–∞–Ω—É (stateless).
- –õ–µ–≥–∫—ñ, —à–≤–∏–¥–∫–æ—Å—Ç–≤–æ—Ä—é–≤–∞–Ω—ñ –æ–±'—î–∫—Ç–∏.

#### **1.2. Scoped**

üîπ **–û–ø–∏—Å**: –û–¥–∏–Ω –µ–∫–∑–µ–º–ø–ª—è—Ä —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ –∫–æ–∂–µ–Ω HTTP-–∑–∞–ø–∏—Ç (—É –≤–µ–±-–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞—Ö).  
üîπ **–ü–µ—Ä–µ–≤–∞–≥–∏**:

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –æ–¥–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É.
- –ú—ñ–Ω—ñ–º—ñ–∑–∞—Ü—ñ—è –≤–∏—Ç—Ä–∞—Ç —É –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ –∑ Transient.  
    üîπ **–ù–µ–¥–æ–ª—ñ–∫–∏**:
- –ù–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Ñ–æ–Ω–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∞–±–æ –∫–æ–¥—É, —â–æ –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —É –º–µ–∂–∞—Ö HTTP-–∑–∞–ø–∏—Ç—É.  
    üîπ **–ü—Ä–∏–∫–ª–∞–¥**:

```csharp
services.AddScoped<IMyService, MyService>();
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏**:

- –°–µ—Ä–≤—ñ—Å–∏, —è–∫—ñ –º–∞—é—Ç—å —Å—Ç–∞–Ω, —â–æ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∑–∞–ø–∏—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–æ–±–æ—Ç–∞ –∑ `DbContext` —É EF Core).
- –í–∑–∞—î–º–æ–¥—ñ—è –∑ –∫–µ—à–∞–º–∏, —â–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏.

#### **1.3. Singleton**

üîπ **–û–ø–∏—Å**: –û–¥–∏–Ω –µ–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—É —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ –≤–µ—Å—å –∂–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –¥–æ–¥–∞—Ç–∫—É.  
üîπ **–ü–µ—Ä–µ–≤–∞–≥–∏**:

- –ó–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –ø–∞–º‚Äô—è—Ç—å (–ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞).
- –ö–æ—Ä–∏—Å–Ω–æ –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤, –∫–µ—à—É, –ª–æ–≥—É–≤–∞–Ω–Ω—è.  
    üîπ **–ù–µ–¥–æ–ª—ñ–∫–∏**:
- –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—é.
- –î–∞–Ω—ñ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–æ, —â–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ —Å—Ç–∞–Ω—É –≥–æ–Ω–∫–∏ (race condition).  
    üîπ **–ü—Ä–∏–∫–ª–∞–¥**:

```csharp
services.AddSingleton<IMyService, MyService>();
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏**:

- –ö–µ—à–æ–≤–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ (MemoryCache, Configuration).
- –õ–æ–≥–µ—Ä–∏, –∫–ª—ñ—î–Ω—Ç–∏ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `HttpClientFactory`).

---

### **2. –ö–æ–Ω—Ç—Ä–æ–ª—å –ñ–∏—Ç—Ç—î–≤–æ–≥–æ –¶–∏–∫–ª—É —á–µ—Ä–µ–∑ Factory Methods**

–Ü–Ω–æ–¥—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Ç–æ—á–Ω—ñ—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –∂–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ–∞–±—Ä–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏.

#### **2.1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ñ–∞–±—Ä–∏—á–Ω–æ–≥–æ –º–µ—Ç–æ–¥—É –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞**

```csharp
services.AddScoped<IMyService>(serviceProvider =>
{
    var config = serviceProvider.GetRequiredService<IConfiguration>();
    return new MyService(config["SomeKey"]);
});
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?**

- –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫–∑–µ–º–ø–ª—è—Ä–∞.

---

### **3. –ö–æ–Ω—Ç—Ä–æ–ª—å –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É —á–µ—Ä–µ–∑ `IDisposable`**

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –≤–∏–∫–ª–∏–∫ `Dispose` —É –æ–±'—î–∫—Ç—ñ–≤, —è–∫—ñ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å `IDisposable`.

#### **3.1. –ü—Ä–∞–≤–∏–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `IDisposable` —É DI**

```csharp
public class MyService : IDisposable
{
    public void Dispose()
    {
        // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤
    }
}
```

–Ø–∫—â–æ —Å–µ—Ä–≤—ñ—Å –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π —è–∫ `Scoped` –∞–±–æ `Singleton`, —Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–∫–ª–∏—á–µ `Dispose` –ø—ñ—Å–ª—è –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è –π–æ–≥–æ –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É.

> **‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ:** –î–ª—è `Transient` –æ–±'—î–∫—Ç—ñ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä **–Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î** –∑–∞ –≤–∏–∫–ª–∏–∫ `Dispose`, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ –ø–æ–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º IoC.

---

## **4. –ì–ª–∏–±–æ–∫–∏–π –∞–Ω–∞–ª—ñ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —Ç–∞ —Ü–∏–∫–ª—ñ–≤**

–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–æ–∂—É—Ç—å —É—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ü–∏–∫–ª–∏, —è–∫—ñ —É—Å–∫–ª–∞–¥–Ω—é—é—Ç—å —Ä–æ–±–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### **4.1. –¶–∏–∫–ª—ñ—á–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ**

–Ø–∫—â–æ –¥–≤–∞ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞–ª–µ–∂–∞—Ç—å –æ–¥–∏–Ω –≤—ñ–¥ –æ–¥–Ω–æ–≥–æ, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–º–æ–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ó—Ö —Å—Ç–≤–æ—Ä–∏—Ç–∏.

#### **4.1.1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Ü–∏–∫–ª—ñ—á–Ω–æ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ**

```csharp
public class A
{
    public A(B b) { }
}

public class B
{
    public B(A a) { }
}
```

üîπ **–†—ñ—à–µ–Ω–Ω—è**:

4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `Lazy<T>`:

```csharp
public class A
{
    private readonly Lazy<B> _b;
    public A(Lazy<B> b) { _b = b; }
}
```

5. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ñ–∞–±—Ä–∏–∫—É (`Func<T>`) –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –Ω–∞ –≤–∏–º–æ–≥—É:

```csharp
public class A
{
    private readonly Func<B> _bFactory;
    public A(Func<B> bFactory) { _bFactory = bFactory; }
}
```

6. –í–∏–Ω–µ—Å—Ç–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤ —ñ–Ω—à–∏–π —Ä—ñ–≤–µ–Ω—å –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó.

---

## **5. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `IServiceScopeFactory` –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Scoped –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –≤ Singleton**

–£ –≤–∏–ø–∞–¥–∫—É, –∫–æ–ª–∏ Singleton –ø–æ–≤–∏–Ω–µ–Ω –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ Scoped –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `IServiceScopeFactory`.

```csharp
public class MySingletonService
{
    private readonly IServiceScopeFactory _serviceScopeFactory;

    public MySingletonService(IServiceScopeFactory serviceScopeFactory)
    {
        _serviceScopeFactory = serviceScopeFactory;
    }

    public void DoWork()
    {
        using (var scope = _serviceScopeFactory.CreateScope())
        {
            var scopedService = scope.ServiceProvider.GetRequiredService<IMyScopedService>();
            scopedService.Process();
        }
    }
}
```

üîπ **–¶–µ –¥–æ–∑–≤–æ–ª—è—î Singleton-—Å–µ—Ä–≤—ñ—Å—É –±–µ–∑–ø–µ—á–Ω–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ Scoped-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ.**

---

## **–í–∏—Å–Ω–æ–≤–∫–∏**

- IoC Container –∑–Ω–∞—á–Ω–æ —Å–ø—Ä–æ—â—É—î —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ —Ç–∞ –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º –æ–±'—î–∫—Ç—ñ–≤.
- –í–∞–∂–ª–∏–≤–æ –≤–∏–±–∏—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∂–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª (`Transient`, `Scoped`, `Singleton`) –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤.
- –ü–æ—Ç—Ä—ñ–±–Ω–æ —É–Ω–∏–∫–∞—Ç–∏ —Ü–∏–∫–ª—ñ—á–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –∞–±–æ –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏ —ó—Ö —á–µ—Ä–µ–∑ `Lazy<T>`, `Func<T>` –∞–±–æ —Ñ–∞–±—Ä–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏.
- `IServiceScopeFactory` –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Scoped —Å–µ—Ä–≤—ñ—Å–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Singleton-–æ–±'—î–∫—Ç—ñ–≤.

–ó–Ω–∞–Ω–Ω—è —Ü–∏—Ö –º–µ—Ö–∞–Ω—ñ–∑–º—ñ–≤ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞–º —Ä–æ–∑—Ä–æ–±–ª—è—Ç–∏ –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ, –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ .NET-–¥–æ–¥–∞—Ç–∫–∏. üöÄ

---

## **Dependency Injection (DI) –Ω–∞ —Ä—ñ–≤–Ω—ñ Advanced —É .NET**

### **1. –í—Å—Ç—É–ø –¥–æ Dependency Injection**

**Dependency Injection (DI)** —î –∫–ª—é—á–æ–≤–∏–º –ø–∞—Ç–µ—Ä–Ω–æ–º –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è —É **.NET**, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –º–µ—Ç–æ–¥ –∞–±–æ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å, –∑–º–µ–Ω—à—É—é—á–∏ –∑–≤'—è–∑–Ω—ñ—Å—Ç—å –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Ç–∞ –ø–æ–∫—Ä–∞—â—É—é—á–∏ —Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å —ñ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å –∫–æ–¥—É.

### **2. –¢–∏–ø–∏ –Ü–Ω'—î–∫—Ü—ñ—ó –ó–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π**

#### **2.1. Constructor Injection (–û—Å–Ω–æ–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥)**

–¶–µ–π –º–µ—Ç–æ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ, –æ—Å–∫—ñ–ª—å–∫–∏ –≥–∞—Ä–∞–Ω—Ç—É—î –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –ø—ñ–¥ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞.

üîπ **–ü—Ä–∏–∫–ª–∞–¥:**

```csharp
public class OrderService : IOrderService
{
    private readonly IPaymentService _paymentService;

    public OrderService(IPaymentService paymentService)
    {
        _paymentService = paymentService ?? throw new ArgumentNullException(nameof(paymentService));
    }
}
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?**

- –ö–æ–ª–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —î **–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ—é** –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —Å–µ—Ä–≤—ñ—Å—É.
- –ö–æ–ª–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π **–æ–±–º–µ–∂–µ–Ω–∞** (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –Ω–µ –±—ñ–ª—å—à–µ 5).

---

#### **2.2. Property Injection (Setter Injection)**

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —î **–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ—é** –∞–±–æ –∫–æ–ª–∏ —ó—ó –Ω–µ–º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

üîπ **–ü—Ä–∏–∫–ª–∞–¥:**

```csharp
public class ReportGenerator
{
    public ILogger Logger { get; set; }

    public void Generate()
    {
        Logger?.Log("–ì–µ–Ω–µ—Ä—É—î–º–æ –∑–≤—ñ—Ç...");
    }
}
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?**

- –Ø–∫—â–æ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —î **–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—é**.
- –ö–æ–ª–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –º–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç–∞.

---

#### **2.3. Method Injection**

–ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –º–µ—Ç–æ–¥—É.

üîπ **–ü—Ä–∏–∫–ª–∞–¥:**

```csharp
public class EmailNotifier
{
    public void SendNotification(string message, IEmailService emailService)
    {
        emailService.Send(message);
    }
}
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?**

- –ö–æ–ª–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–ª–∏—à–µ –≤ –æ–¥–Ω–æ–º—É –º–µ—Ç–æ–¥—ñ**.
- –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ **–º—ñ–Ω—ñ–º—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤ –∫–ª–∞—Å—ñ**.

---

### **3. –ñ–∏—Ç—Ç—î–≤—ñ –¶–∏–∫–ª–∏ —Ç–∞ DI**

IoC-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–µ—Ä—É—î –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ **Scoped**, **Singleton** —Ç–∞ **Transient**, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤.

üîπ **–¢–∏–ø–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó:**

|–ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª|–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?|
|---|---|
|`Transient`|–õ–µ–≥–∫–æ–≤–∞–≥—ñ —Å–µ—Ä–≤—ñ—Å–∏, –±–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É (stateless).|
|`Scoped`|–°–µ—Ä–≤—ñ—Å–∏, —â–æ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ HTTP-–∑–∞–ø–∏—Ç—É.|
|`Singleton`|–ö–µ—à–æ–≤–∞–Ω—ñ –∞–±–æ –≥–ª–æ–±–∞–ª—å–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏, —â–æ —ñ—Å–Ω—É—é—Ç—å –ø—Ä–æ—Ç—è–≥–æ–º —É—Å—å–æ–≥–æ —á–∞—Å—É –∂–∏—Ç—Ç—è –¥–æ–¥–∞—Ç–∫–∞.|

---

### **4. –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –î–∏–Ω–∞–º—ñ—á–Ω–∏–º–∏ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏**

–Ü–Ω–æ–¥—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –ø—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó. –£ —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **Factory Pattern**, `Func<T>` –∞–±–æ `Lazy<T>`.

#### **4.1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Factory Pattern**

üîπ **–ü—Ä–∏–∫–ª–∞–¥:**

```csharp
public interface IServiceFactory
{
    IReportService CreateService(string reportType);
}

public class ServiceFactory : IServiceFactory
{
    private readonly IServiceProvider _serviceProvider;

    public ServiceFactory(IServiceProvider serviceProvider)
    {
        _serviceProvider = serviceProvider;
    }

    public IReportService CreateService(string reportType)
    {
        return reportType switch
        {
            "PDF" => _serviceProvider.GetRequiredService<PdfReportService>(),
            "Excel" => _serviceProvider.GetRequiredService<ExcelReportService>(),
            _ => throw new ArgumentException("Unknown report type")
        };
    }
}
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?**

- –Ø–∫—â–æ —Å—Ç–≤–æ—Ä—é–≤–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ **–¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤**.
- –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ **—ñ–Ω–∫–∞–ø—Å—É–ª—é–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π**.

---

#### **4.2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Func<T>` –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç—ñ–≤ –Ω–∞ –≤–∏–º–æ–≥—É**

```csharp
public class OrderProcessor
{
    private readonly Func<IDiscountService> _discountServiceFactory;

    public OrderProcessor(Func<IDiscountService> discountServiceFactory)
    {
        _discountServiceFactory = discountServiceFactory;
    }

    public void ProcessOrder()
    {
        var discountService = _discountServiceFactory();
        discountService.ApplyDiscount();
    }
}
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?**

- –ö–æ–ª–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —î **–≤–∏—Ç—Ä–∞—Ç–Ω–∏–º** —ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —ó—ó **–ª–∏—à–µ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ**.

---

#### **4.3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Lazy<T>` –¥–ª—è –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó**

```csharp
public class HeavyService
{
    public HeavyService() { Console.WriteLine("HeavyService —Å—Ç–≤–æ—Ä–µ–Ω–æ!"); }
}

public class Consumer
{
    private readonly Lazy<HeavyService> _heavyService;

    public Consumer(Lazy<HeavyService> heavyService)
    {
        _heavyService = heavyService;
    }

    public void UseService()
    {
        var service = _heavyService.Value; // –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ª–∏—à–µ —Ç—É—Ç
        Console.WriteLine("–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è HeavyService...");
    }
}
```

üîπ **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏?**

- –ö–æ–ª–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å **–¥–æ—Ä–æ–≥–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏**, —ñ –≤–æ–Ω–∞ **–º–æ–∂–µ –Ω–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è**.

---

### **5. –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è DI —É Middleware —Ç–∞ Background Services**

#### **5.1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è DI —É Middleware**

üîπ **–ü—Ä–∏–∫–ª–∞–¥ –≤–ª–∞—Å–Ω–æ–≥–æ Middleware –∑ DI:**

```csharp
public class CustomMiddleware
{
    private readonly RequestDelegate _next;
    private readonly ILogger _logger;

    public CustomMiddleware(RequestDelegate next, ILogger<CustomMiddleware> logger)
    {
        _next = next;
        _logger = logger;
    }

    public async Task Invoke(HttpContext context)
    {
        _logger.LogInformation("–ó–∞–ø–∏—Ç –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è Middleware...");
        await _next(context);
    }
}
```

üîπ **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤ `Startup.cs`:**

```csharp
app.UseMiddleware<CustomMiddleware>();
```

---

#### **5.2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è DI —É Hosted Services**

üîπ **–ü—Ä–∏–∫–ª–∞–¥ Background Service –∑ DI:**

```csharp
public class WorkerService : BackgroundService
{
    private readonly IServiceScopeFactory _scopeFactory;

    public WorkerService(IServiceScopeFactory scopeFactory)
    {
        _scopeFactory = scopeFactory;
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        using var scope = _scopeFactory.CreateScope();
        var myService = scope.ServiceProvider.GetRequiredService<IMyScopedService>();

        while (!stoppingToken.IsCancellationRequested)
        {
            myService.DoWork();
            await Task.Delay(1000, stoppingToken);
        }
    }
}
```

üîπ **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤ `Program.cs`:**

```csharp
services.AddHostedService<WorkerService>();
```

---

### **6. –í–∏—Ä—ñ—à–µ–Ω–Ω—è –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö –ü—Ä–æ–±–ª–µ–º**

#### **6.1. –¶–∏–∫–ª—ñ—á–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ**

üîπ **–Ø–∫—â–æ –∫–ª–∞—Å A –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–ª–∞—Å—É B, –∞ B ‚Äì –≤—ñ–¥ A:**

```csharp
public class A { public A(B b) { } }
public class B { public B(A a) { } }
```

üîπ **–†—ñ—à–µ–Ω–Ω—è:**

1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ —Ç—Ä–µ—Ç—ñ–π –∫–ª–∞—Å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Service Locator).**
2. **Lazy –∞–±–æ Func –¥–ª—è –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.**
3. **Factory Pattern –¥–ª—è —è–≤–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤.**

---

### **7. –í–∏—Å–Ω–æ–≤–∫–∏**

- **Constructor Injection** ‚Äì –æ—Å–Ω–æ–≤–Ω–∏–π —ñ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥.
- **Factory Pattern, Func —ñ Lazy** –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∫–µ—Ä—É–≤–∞—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π **–Ω–∞ –≤–∏–º–æ–≥—É**.
- **Scoped —Å–µ—Ä–≤—ñ—Å–∏ –Ω–µ –º–æ–∂–Ω–∞ –Ω–∞–ø—Ä—è–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É Singleton** ‚Äì —Å–ª—ñ–¥ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ `IServiceScopeFactory`.
- **DI –≤ Middleware —Ç–∞ Background Services** –ø–æ—Ç—Ä–µ–±—É—î –æ–∫—Ä–µ–º–∏—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤.
- **–£–Ω–∏–∫–Ω–µ–Ω–Ω—è —Ü–∏–∫–ª—ñ—á–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π** –ø–æ–∫—Ä–∞—â—É—î –≥–Ω—É—á–∫—ñ—Å—Ç—å —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏.

–¶–µ –∑–Ω–∞–Ω–Ω—è –¥–∞—î –∑–º–æ–≥—É –±—É–¥—É–≤–∞—Ç–∏ **–≥–Ω—É—á–∫—ñ, –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ —Ç–∞ —Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ** .NET-–¥–æ–¥–∞—Ç–∫–∏! üöÄ